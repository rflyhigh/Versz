<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TiffinTreats - Home</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <style>
        .gradient-background {
            background: linear-gradient(135deg, #ffa07a 0%, #ff7f50 100%);
        }
        .card {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.9);
        }
    </style>
</head>
<body class="gradient-background min-h-screen">
    <!-- Login Page (Initial View) -->
    <div id="loginPage" class="container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="p-6">
                <img src="/api/placeholder/200/100" alt="TiffinTreats Logo" class="mx-auto mb-6">
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Welcome to TiffinTreats</h2>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700">Username</label>
                        <input type="text" id="username" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-orange-500">
                    </div>
                    <div>
                        <label class="block text-gray-700">Password</label>
                        <input type="password" id="password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-orange-500">
                    </div>
                    <button type="submit" class="w-full py-2 px-4 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition duration-200">
                        Login
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Dashboard (Hidden Initially) -->
    <div id="dashboard" class="hidden">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <img src="/api/placeholder/40/40" alt="Logo" class="h-10">
                        <span class="ml-2 text-xl font-semibold text-gray-800">TiffinTreats</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="userWelcome" class="text-gray-600"></span>
                        <button id="logoutBtn" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8">
            <!-- Today's Tiffins -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Today's Tiffins</h2>
                <div id="tiffinContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Tiffin cards will be inserted here -->
                </div>
            </div>

            <!-- Active Polls -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Food Preference Polls</h2>
                <div id="pollContainer" class="space-y-4">
                    <!-- Polls will be inserted here -->
                </div>
            </div>

            <!-- Notice Board -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Notice Board</h2>
                <div id="noticeContainer" class="space-y-4">
                    <!-- Notices will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard (Hidden Initially) -->
    <div id="adminDashboard" class="hidden">
        <!-- Admin Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="container mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <img src="/api/placeholder/40/40" alt="Logo" class="h-10">
                        <span class="ml-2 text-xl font-semibold text-gray-800">TiffinTreats Admin</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="adminLogoutBtn" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Admin Content -->
        <div class="container mx-auto px-4 py-8">
            <!-- Create Tiffin -->
            <div class="mb-8 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Create Tiffin</h2>
                <form id="createTiffinForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700">Date</label>
                            <input type="date" id="tiffinDate" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700">Time Slot</label>
                            <select id="timeSlot" class="w-full px-4 py-2 border rounded-lg">
                                <option value="morning">Morning (9 AM)</option>
                                <option value="evening">Evening (9 PM)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700">Menu</label>
                        <textarea id="menu" class="w-full px-4 py-2 border rounded-lg" rows="3"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700">Price (â‚¹)</label>
                        <input type="number" id="price" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <button type="submit" class="w-full py-2 px-4 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                        Create Tiffin
                    </button>
                </form>
            </div>

            <!-- Create Poll -->
            <div class="mb-8 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Create Poll</h2>
                <form id="createPollForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700">Title</label>
                        <input type="text" id="pollTitle" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <div id="pollOptions" class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <input type="text" class="flex-1 px-4 py-2 border rounded-lg" placeholder="Option 1">
                            <button type="button" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                Remove
                            </button>
                        </div>
                    </div>
                    <button type="button" id="addOption" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                        Add Option
                    </button>
                    <div>
                        <label class="block text-gray-700">End Time</label>
                        <input type="datetime-local" id="pollEndTime" class="w-full px-4 py-2 border rounded-lg">
                    </div>
                    <button type="submit" class="w-full py-2 px-4 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                        Create Poll
                    </button>
                </form>
            </div>

            <!-- User Management -->
            <div class="mb-8 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">User Management</h2>
                <div id="userList" class="space-y-4">
                    <!-- Users will be listed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://tiffintreats.onrender.com'; // Change this to your backend URL
        let isAdmin = false;

        // Login Handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await axios.post(`${API_BASE_URL}/login`, {
                    username,
                    password
                });

                if (response.data.is_admin) {
                    isAdmin = true;
                    document.getElementById('loginPage').classList.add('hidden');
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    loadAdminDashboard();
                } else {
                    document.getElementById('loginPage').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('userWelcome').textContent = `Welcome, ${username}!`;
                    loadUserDashboard();
                }
            } catch (error) {
                alert('Invalid credentials');
            }
        });

        // Load User Dashboard
        async function loadUserDashboard() {
            loadTodayTiffins();
            loadActivePolls();
        }

        // Load Today's Tiffins
        async function loadTodayTiffins() {
            try {
                const response = await axios.get(`${API_BASE_URL}/tiffins/today`);
                const container = document.getElementById('tiffinContainer');
                container.innerHTML = '';

                response.data.forEach(tiffin => {
                    const card = createTiffinCard(tiffin);
                    container.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading tiffins:', error);
            }
        }

        // Create Tiffin Card
        function createTiffinCard(tiffin) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-lg p-6 card';
            card.innerHTML = `
                <h3 class="text-xl font-bold text-gray-800 mb-2">${tiffin.time_slot} Tiffin</h3>
                <p class="text-gray-600 mb-4">${tiffin.menu}</p>
                <div class="flex justify-between items-center">
                    <span class="text-lg font-bold text-orange-500">â‚¹${tiffin.price}</span>
                    <button onclick="cancelTiffin(${tiffin.id})" 
                            class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                            ${canCancel(tiffin) ? '' : 'disabled'}>
                        Cancel
                    </button>
                </div>
                <div class="mt-2">
                    <span class="text-sm text-gray-500">Status: ${tiffin.status}</span>
                </div>
            `;
            return card;
        }

        // Check if Tiffin can be cancelled
        function canCancel(tiffin) {
            const now = new Date();
            const deliveryTime = new Date();
            deliveryTime.setHours(tiffin.time_slot === 'morning' ? 9 : 21, 0, 0);
            const deadline = new Date(deliveryTime.getTime() - (3 * 60 * 60 * 1000));
            return now < deadline;
        }

        // Cancel Tiffin
        async function cancelTiffin(tiffinId) {
            try {
                await axios.post(`${API_BASE_URL}/order/${tiffinId}/cancel`);
                alert('Tiffin cancelled successfully');
                loadTodayTiffins();
            } catch (error) {
                alert('Unable to cancel tiffin');
            }
        }

        // Load Admin Dashboard
        async function loadAdminDashboard() {
            // Implementation for admin dashboard loading
            // This would include loading user list, managing tiffins, etc.
        }

        // Logout Handler
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await axios.get(`${API_BASE_URL}/logout`);
                window.location.reload();
            } catch (error) {
                console.error('Error logging out:', error);
            }
        });

        document.getElementById('adminLogoutBtn').addEventListener('click', async () => {
            try {
                await axios.get(`${API_BASE_URL}/logout`);
                window.location.reload();
            } catch (error) {
                console.error('Error logging out:', error);
            }
        });

        // Add more functionality for admin dashboard, polls, and notices here
      
    <!DOCTYPE html>
<!-- Previous HTML structure remains the same until the script section -->
<!-- After the existing script content, add the following: -->

<script>
    // Previous script content remains the same, then add:

    // Admin Dashboard Functions
    async function loadAdminDashboard() {
        loadUserList();
        loadAdminTiffins();
        loadAdminPolls();
        loadAdminNotices();
    }

    // User Management
    async function loadUserList() {
        const userList = document.getElementById('userList');
        try {
            const response = await axios.get(`${API_BASE_URL}/admin/users`);
            userList.innerHTML = '';

            response.data.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'bg-white rounded-lg shadow p-4 flex justify-between items-center';
                userCard.innerHTML = `
                    <div>
                        <h3 class="font-bold">${user.username}</h3>
                        <p class="text-sm text-gray-500">Created: ${new Date(user.created_at).toLocaleDateString()}</p>
                    </div>
                    <button onclick="deleteUser('${user._id}')" 
                            class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                        Delete
                    </button>
                `;
                userList.appendChild(userCard);
            });
        } catch (error) {
            console.error('Error loading users:', error);
        }
    }

    async function deleteUser(userId) {
        if (confirm('Are you sure you want to delete this user?')) {
            try {
                await axios.delete(`${API_BASE_URL}/admin/users/${userId}`);
                loadUserList();
            } catch (error) {
                alert('Error deleting user');
            }
        }
    }

    // Tiffin Management for Admin
    async function loadAdminTiffins() {
        try {
            const response = await axios.get(`${API_BASE_URL}/admin/tiffins`);
            const container = document.getElementById('adminTiffinContainer');
            container.innerHTML = '';

            response.data.forEach(tiffin => {
                const card = createAdminTiffinCard(tiffin);
                container.appendChild(card);
            });
        } catch (error) {
            console.error('Error loading admin tiffins:', error);
        }
    }

    function createAdminTiffinCard(tiffin) {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg shadow-lg p-6 mb-4';
        card.innerHTML = `
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="text-xl font-bold">${tiffin.time_slot} Tiffin</h3>
                    <p class="text-gray-600">${new Date(tiffin.date).toLocaleDateString()}</p>
                </div>
                <div class="flex space-x-2">
                    <select onchange="updateTiffinStatus('${tiffin._id}', this.value)" 
                            class="px-3 py-1 border rounded">
                        <option value="cooking" ${tiffin.status === 'cooking' ? 'selected' : ''}>Cooking</option>
                        <option value="delivering" ${tiffin.status === 'delivering' ? 'selected' : ''}>Delivering</option>
                        <option value="completed" ${tiffin.status === 'completed' ? 'selected' : ''}>Completed</option>
                    </select>
                    <button onclick="deleteTiffin('${tiffin._id}')" 
                            class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                        Delete
                    </button>
                </div>
            </div>
            <p class="text-gray-700 mb-2">${tiffin.menu}</p>
            <p class="text-lg font-bold text-orange-500">â‚¹${tiffin.price}</p>
        `;
        return card;
    }

    async function updateTiffinStatus(tiffinId, status) {
        try {
            await axios.put(`${API_BASE_URL}/admin/tiffin/${tiffinId}/status`, { status });
            loadAdminTiffins();
        } catch (error) {
            alert('Error updating tiffin status');
        }
    }

    async function deleteTiffin(tiffinId) {
        if (confirm('Are you sure you want to delete this tiffin?')) {
            try {
                await axios.delete(`${API_BASE_URL}/admin/tiffin/${tiffinId}`);
                loadAdminTiffins();
            } catch (error) {
                alert('Error deleting tiffin');
            }
        }
    }

    // Poll Management
    async function loadAdminPolls() {
        try {
            const response = await axios.get(`${API_BASE_URL}/admin/polls`);
            const container = document.getElementById('adminPollContainer');
            container.innerHTML = '';

            response.data.forEach(poll => {
                const card = createAdminPollCard(poll);
                container.appendChild(card);
            });
        } catch (error) {
            console.error('Error loading admin polls:', error);
        }
    }

    function createAdminPollCard(poll) {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg shadow-lg p-6 mb-4';
        card.innerHTML = `
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-xl font-bold">${poll.title}</h3>
                <button onclick="deletePoll('${poll._id}')"
                        class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                    Delete
                </button>
            </div>
            <p class="text-gray-600 mb-2">Ends: ${new Date(poll.end_time).toLocaleString()}</p>
            <div class="space-y-2">
                ${poll.options.map(option => `
                    <div class="flex justify-between items-center">
                        <span>${option}</span>
                        <span class="font-bold">${poll.results?.[option] || 0} votes</span>
                    </div>
                `).join('')}
            </div>
        `;
        return card;
    }

    // Notice Board Management
    async function loadAdminNotices() {
        try {
            const response = await axios.get(`${API_BASE_URL}/admin/notices`);
            const container = document.getElementById('adminNoticeContainer');
            container.innerHTML = '';

            response.data.forEach(notice => {
                const card = createAdminNoticeCard(notice);
                container.appendChild(card);
            });
        } catch (error) {
            console.error('Error loading admin notices:', error);
        }
    }

    function createAdminNoticeCard(notice) {
        const card = document.createElement('div');
        card.className = 'bg-white rounded-lg shadow-lg p-6 mb-4';
        card.innerHTML = `
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="text-xl font-bold">${notice.title}</h3>
                    <p class="text-gray-500 text-sm">${new Date(notice.created_at).toLocaleString()}</p>
                </div>
                <button onclick="deleteNotice('${notice._id}')"
                        class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                    Delete
                </button>
            </div>
            <p class="text-gray-700">${notice.content}</p>
        `;
        return card;
    }

    // Form Handlers
    document.getElementById('createTiffinForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = {
            date: document.getElementById('tiffinDate').value,
            time_slot: document.getElementById('timeSlot').value,
            menu: document.getElementById('menu').value,
            price: document.getElementById('price').value
        };

        try {
            await axios.post(`${API_BASE_URL}/admin/tiffin`, formData);
            alert('Tiffin created successfully');
            loadAdminTiffins();
            e.target.reset();
        } catch (error) {
            alert('Error creating tiffin');
        }
    });

    document.getElementById('createPollForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const options = Array.from(document.querySelectorAll('#pollOptions input'))
            .map(input => input.value)
            .filter(value => value.trim() !== '');

        const formData = {
            title: document.getElementById('pollTitle').value,
            options: options,
            end_time: document.getElementById('pollEndTime').value
        };

        try {
            await axios.post(`${API_BASE_URL}/admin/polls`, formData);
            alert('Poll created successfully');
            loadAdminPolls();
            e.target.reset();
        } catch (error) {
            alert('Error creating poll');
        }
    });

    // Poll Option Management
    document.getElementById('addOption').addEventListener('click', () => {
        const optionsContainer = document.getElementById('pollOptions');
        const newOption = document.createElement('div');
        newOption.className = 'flex items-center space-x-2';
        newOption.innerHTML = `
            <input type="text" class="flex-1 px-4 py-2 border rounded-lg" 
                   placeholder="Option ${optionsContainer.children.length + 1}">
            <button type="button" onclick="this.parentElement.remove()"
                    class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                Remove
            </button>
        `;
        optionsContainer.appendChild(newOption);
    });

    // Vote on Poll
    async function votePoll(pollId, option) {
        try {
            await axios.post(`${API_BASE_URL}/polls/${pollId}/vote`, { option });
            loadActivePolls();
        } catch (error) {
            alert('Error voting on poll');
        }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
        const token = localStorage.getItem('auth_token');
        if (token) {
            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
            if (isAdmin) {
                loadAdminDashboard();
            } else {
                loadUserDashboard();
            }
        }
    });
</script>
</body>
</html>
